define(["require","exports","jquery","knockout","../../common/options/option_event_name","../options/cart_options","../../common/options/option_domain","../../common/services/event","../../common/services/util","../../common/services/stop_propagation","../../common/services/search_collection"],function(t,e,i,a,n,o,s,c,r,E,l){"use strict";var d=i(document),C="click.activity_selector",u=function(){function t(){}return t.bindEvents=function(e){var s=i(e);return s.on({click:function(){var e=t.getPackageCartDetailIds(i(this)),a=i(this).hasClass("selected");c.broadcast(o.CART_EVENT_NAME.CHANGE_SELECTED,e,!a,!0)}},".J-event-packageCheckbox"),s.on({click:function(e){E.stopPropagationFun(e);var a=[],n=t.getCartDetailID(i(this),!0);a.push(n);var s=i(this).hasClass("selected");c.broadcast(o.CART_EVENT_NAME.CHANGE_SELECTED,a,!s,!1)}},".J-event-select"),s.on({click:function(){var e=t.getCartDetailID(i(this),!1),a=l.item(e),n=Number(a.qty);if(!(1>=n)){var s=n-1;t.updateItemNum(i(this),s),c.broadcast(o.CART_EVENT_NAME.CHANGE_PURCHASES,e,s)}}},".J-event-itemSub"),s.on({click:function(){if(!i(this).hasClass("disabled")){var e=t.getCartDetailID(i(this),!1),a=l.item(e),n=Number(a.qty),s=n+1;s>a.stock&&(s=a.stock),t.updateItemNum(i(this),s),c.broadcast(o.CART_EVENT_NAME.CHANGE_PURCHASES,e,s)}}},".J-event-itemAdd"),s.on({blur:function(){var e=t.getCartDetailID(i(this),!1),a=l.item(e),n=Number(a.qty),s=i(this).val(),r=/^[0-9]*[1-9][0-9]*$/;return r.test(String(s))?(s>a.stock&&(s=a.stock),t.updateItemNum(i(this),s),void c.broadcast(o.CART_EVENT_NAME.CHANGE_PURCHASES,e,s)):void i(this).val(n)}},".J-event-itemIpt"),s.on({click:function(e){var n=i(this),s="im-click",u=t.getCartDetailID(n,!1),v=n.hasClass(s);if(E.stopPropagationFun(e),v)return n.removeClass(s),void c.broadcast(o.CART_EVENT_NAME.CLOSE_ACTIVITY);n.addClass(s);var _=r.getOffset(e),h=l.item(u),m={isShow:!0,itemDetailID:h.detailId,activityList:h.campSeqList,activityCode:h.campSeq,offset:_};c.broadcast(o.CART_EVENT_NAME.CHANGE_ACTIVITY,m),d.on(C,function(){a.tasks.schedule(function(){n.removeClass(s),c.broadcast(o.CART_EVENT_NAME.CLOSE_ACTIVITY)})})}},".J-event-modifyActivity"),s.on({click:function(e){var a=t.getCartDetailID(i(this),!1);c.broadcast(o.CART_EVENT_NAME.ADD_TO_FAVORITE,{event:e,id:a})}},".J-event-itemAddFavorite"),s.on({click:function(e){var a=t.getCartDetailID(i(this),!1),n={activityCode:"-1",id:a};return c.broadcast(o.CART_EVENT_NAME.CHANGE_ACTIVITY_CONFIRM,n),!1}},".J-noact"),s.on({click:function(e){var a=[],s=t.getCartDetailID(i(this),!1);a.push(s);var r=l.item(s);if(r.isPrize)var E="确认要放弃该奖品吗？删除后不可恢复噢？";else if(r.isVoucherPresent)var E="确认要放弃该礼品吗？删除后不返还券噢？";else var E="确认要放弃该商品吗？";c.broadcast(n.COMMON_EVENT_NAME.ART_DIALOG,{id:"delItem",e:e,headhide:1,htmlcont:E,okcallback:function(t,e){c.broadcast(o.CART_EVENT_NAME.DEL_ITEM_CONFIRM,a,!1),t&&t()},nocallback:function(t,e){t&&t()}})}},".J-event-itemDel"),s.on({click:function(){i(this).next().is(":hidden")?(i(this).next().show(),i(this).addClass("im-click")):(i(this).next().hide(),i(this).removeClass("im-click"))}},".J-event-mainComboNext"),s.on({click:function(t){E.stopPropagationFun(t,o.CART_EVENT_NAME.CLOSE_TRIGGER_RECOMMEND);var e=i(this).parents(".J-level-shop").attr("shopId"),a=i(this).parents(".J-level-shop").attr("freightfreeneed"),n=i(this).parents(".J-level-shop").attr("isFresh");c.broadcast(o.CART_EVENT_NAME.LOAD_TRIGGER_RECOMMEND,{packageId:e,freightfreeneed:a,isFresh:n,offset:r.getOffset(t)})}},".J-event-recommend"),s.on({click:function(){var e=t.getCartDetailID(i(this),!1),a=i(this).hasClass("selected");c.broadcast(o.CART_EVENT_NAME.MODIFY_SCORE,e,!a)}},".J-event-modifyScore"),s.on({click:function(t){var e=this,n=i(this).hasClass("im-click");E.stopPropagationFun(t),n?(i(this).removeClass("im-click"),c.broadcast(o.CART_EVENT_NAME.CLOSE_VOUCHER_SELECTOR)):(i(this).addClass("im-click"),c.broadcast(o.CART_EVENT_NAME.LOAD_VOUCHER_LIST,r.getOffset(t),i(this).attr("packageId"))),d.on(C,function(){a.tasks.schedule(function(){i(e).removeClass("im-click"),c.broadcast(o.CART_EVENT_NAME.CLOSE_VOUCHER_SELECTOR)})})}},".J-event-voucher"),s.on({click:function(){var t=i(this).attr("campSeq"),e=i(this).text();c.broadcast(o.CART_EVENT_NAME.SHOW_GIFT_SELECTOR,t,e)}},".J-event-chooseGift"),s.on({click:function(){var e=i(this).attr("shopid"),a=null;i.each(l.items,function(t,i){return i.packageNo==e?(a=i.skuId,!1):void 0}),t.clickLive800(!0,a)}},".J-transfer-clickLive800"),s},t.clickLive800=function(t,e){if(t){var i=s.MOUMOU_TRANSFER_URL;null!=e&&(i+="&productId="+e),window.open(i,"toolbar=no,titlebar=no,status=no,menubar=no,location=no,height=660,width=750")}},t.getPackageCartDetailIds=function(t){var e=[];return t.parents(".J-level-shop").find(".J-event-select").each(function(t,a){e.push(i(a).attr("data-cartdetailid"))}),e},t.getCartDetailID=function(t,e){return e?t.attr("data-cartDetailId"):t.parents(".J-level-itemContent").attr("data-cartDetailId")},t.updateItemNum=function(t,e){t.parent().find(".J-event-itemIpt").val(e)},t}();return u});
//# sourceMappingURL=cart_bind_event.js.map